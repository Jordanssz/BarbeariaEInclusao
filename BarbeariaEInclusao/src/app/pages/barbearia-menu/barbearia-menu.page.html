<ion-split-pane contentId="main-content">
  <ion-menu contentId="main-content" side="start">
    <ion-header>
      <ion-toolbar>
        <ion-title>Menu</ion-title>
      </ion-toolbar>
    </ion-header>
    <ion-content>
      <ion-list>
        <ion-menu-toggle auto-hide="false">
          <ion-item button [routerLink]="['/agenda-barbearia']">
            <ion-icon name="calendar-outline" slot="start"></ion-icon>
            <ion-label>Agenda</ion-label>
          </ion-item>
        </ion-menu-toggle>

        <ion-menu-toggle auto-hide="false">
          <ion-item button [routerLink]="['/cadastro-barbearia', barbearia.idBarbearia]">
            <ion-icon name="create-outline" slot="start"></ion-icon>
            <ion-label>Alterar Dados da Barbearia</ion-label>
          </ion-item>
        </ion-menu-toggle>

        <ion-menu-toggle auto-hide="false">
          <ion-item button [routerLink]="['/barbearia-acessibilidades']">
            <ion-icon name="accessibility-outline" slot="start"></ion-icon>
            <ion-label>Características de Acessibilidade</ion-label>
          </ion-item>
        </ion-menu-toggle>

        <ion-item lines="none" class="separator-item"></ion-item>

        <ion-menu-toggle auto-hide="false">
          <ion-item button color="danger" (click)="excluirBarbearia()">
            <ion-icon name="trash-outline" slot="start"></ion-icon>
            <ion-label>Excluir Barbearia</ion-label>
          </ion-item>
        </ion-menu-toggle>
      </ion-list>
    </ion-content>
  </ion-menu>

  <div class="ion-page" id="main-content">
    <ion-header class="custom-header">
      <ion-toolbar>
        <div class="header-icons">
          <ion-buttons slot="start">
            <ion-menu-button></ion-menu-button>
          </ion-buttons>

          <ion-buttons slot="end">
            <ion-button fill="clear" class="icon-btn" aria-label="Logout" (click)="logout()">
              <ion-icon name="log-out-outline"></ion-icon>
            </ion-button>
          </ion-buttons>
        </div>
      </ion-toolbar>
    </ion-header>

    <ion-content class="custom-bg" [fullscreen]="true">
      <div class="barbearia-container">
        <div class="barbearia-top">

          <div class="profile-pic-box">
            <img
              [src]="barbearia.fotoBarbearia || 'assets/avatar-placeholder.svg'"
              alt="Avatar da Barbearia"
              class="profile-pic"
              onerror="this.onerror=null; this.src='assets/avatar-placeholder.svg';"
            />
          </div>
          
          <!-- Comentários (moveram para o final da página) -->

          <div class="barbearia-info">
            <div class="barbearia-nome-edit">
              <span class="barbearia-nome">{{ barbearia.nomeBarbearia }}</span>
            </div>
            <div class="barbearia-desc-edit">
              <span class="barbearia-desc">{{ barbearia.descricaoBarbearia }}</span>
            </div>
            <div class="barbearia-endereco-edit">
              <div class="barbearia-endereco">
                <ion-icon name="location-outline" class="location-icon"></ion-icon>
                <span>{{ enderecoCompleto }}</span>
              </div>
              <ion-button fill="clear" class="edit-btn" size="small" [routerLink]="['/cadastro-barbearia', barbearia.idBarbearia]">
                <ion-icon name="pencil-outline"></ion-icon>
              </ion-button>
            </div>
            <div class="barbearia-rating">
              <ng-container *ngFor="let star of [1,2,3,4,5]">
                <ion-icon [name]="getStarIcon(star)" class="star-icon"></ion-icon>
              </ng-container>
              <span class="avaliacao-label">({{ avaliacaoMedia | number:'1.1-1' }}) • {{ comentarios?.length || 0 }} avaliações</span>
              <ion-button fill="clear" class="comentarios-btn" [routerLink]="'/comentarios'">
                <ion-icon name="chevron-forward-outline"></ion-icon>
              </ion-button>
            </div>
            <div class="alterar-dados-btn-wrapper">
            </div>

            <div class="acessibilidade-section" *ngIf="caracteristicasAcessiveis.length > 0">
  <div class="acessibilidade-title">
    Características de acessibilidade:
  </div>
  <div class="acessibilidade-tags">
    <ion-chip 
      *ngFor="let nome of caracteristicasAcessiveis" 
      class="acessibilidade-chip"
    >
      <ion-icon name="checkmark-circle-outline"></ion-icon>
      <ion-label>{{ nome }}</ion-label>
    </ion-chip>
  </div>
</div>
            </div>
        </div>

        <div class="servicos-section">
          <div class="servicos-title">Serviços</div>
          <div class="servicos-list">
            <div class="servico-card" *ngFor="let servico of servicos">
              <img [src]="servico.fotoServico || 'assets/no-image.svg'" alt="Imagem do Serviço" class="servico-img" />
              <div class="servico-info">
                <span class="servico-nome">{{ servico.nomeServico }}</span>
                <span class="servico-preco">R${{ servico.precoServico | number:'1.2-2' }}</span>
                <span class="servico-desc">{{ servico.descricaoServico }}</span>
              </div>
              <div class="servico-actions">
                <ion-button
                  class="editar-servico-btn"
                  fill="solid"
                  size="small"
                  [routerLink]="['/add-servico', servico.idServico]">
                  Editar
                </ion-button>
                <ion-button
                  class="excluir-servico-btn"
                  fill="solid"
                  color="danger"
                  size="small"
                  (click)="excluirServico(servico.idServico)">
                  Excluir
                </ion-button>
              </div>
            </div>
            <div class="no-servicos" *ngIf="servicos.length === 0">
              Nenhuma serviço cadastrado ainda.
            </div>
          </div>
          <div class="adicionar-servico-wrapper">
            <ion-button class="adicionar-servico-btn" routerLink="/add-servico" expand="block">
              Adicionar serviços +
            </ion-button>
          </div>
        </div>
        
        <div class="profissionais-section">
          <div class="profissionais-title">Profissionais</div>
          <div class="profissionais-list">
            <div class="profissional-card" *ngFor="let p of profissionais">
              <img [src]="p.fotoProfissional || 'assets/avatar-placeholder.svg'" alt="Foto do Profissional" class="profissional-img" />
              <div class="profissional-info">
                <span class="profissional-nome">{{ p.nomeProfissional || p.nome || p.apelido }}</span>
                <span class="profissional-role" *ngIf="p.funcao">{{ p.funcao }}</span>
              </div>
                  <div class="profissional-actions">
                    <ion-button fill="clear" size="small" color="danger" (click)="removerProfissional(p.idProfissional)">Remover</ion-button>
                  </div>
            </div>
            <div class="no-profissionais" *ngIf="profissionais.length === 0">
              Nenhum profissional cadastrado ainda.
            </div>
          </div>
          
          <!-- Botão para adicionar profissional -->
          <div *ngIf="!adicionandoProfissional" class="adicionar-profissional-wrapper">
            <ion-button class="adicionar-profissional-btn" (click)="navegarParaAdicionarProfissional()" expand="block">
              Adicionar profissional +
            </ion-button>
          </div>

          <!-- Área para inserir código do profissional -->
          <div *ngIf="adicionandoProfissional" class="add-profissional-box">
            <div class="profissional-icon-box">
              <ion-icon name="person-circle-outline"></ion-icon>
            </div>
            <input class="codigo-profissional-input" [(ngModel)]="codigoProfissional" placeholder="Código do profissional" />
            <div class="profissional-buttons">
              <button class="confirmar-add-btn" (click)="confirmarAdicionarProfissional()">Adicionar</button>
              <button class="cancelar-add-btn" (click)="cancelarAdicionarProfissional()">Cancelar</button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Comentários (apenas serviço e profissional) -->
      <div class="comentarios-section" *ngIf="comentarios && comentarios.length > 0">
        <div class="comentarios-title">Histórico de Serviços</div>
        <div class="comentario-card" *ngFor="let c of comentarios">
            <div class="comentario-header">
              <strong>{{ c.nomeUsuario }}</strong>
              <span class="comentario-meta"> - {{ c.nomeServico }} • {{ c.nomeProfissional }}</span>
            </div>
            <div class="comentario-stars">
              <ng-container *ngFor="let s of [1,2,3,4,5]">
                <ion-icon [name]="( (Math.round((c.nota||0)*2)) >= (s*2 - 1) ? ( ( (Math.round((c.nota||0)*2)) >= s*2 ) ? 'star' : 'star-half' ) : 'star-outline' )" class="star-icon"></ion-icon>
              </ng-container>
              <span class="comentario-nota">({{ c.nota }})</span>
            </div>
            <div class="comentario-text">{{ c.comentario }}</div>
          </div>
      </div>
    </ion-content>
  </div>
</ion-split-pane>